# Auction Game

## Rule

### 概要

$N$人のプレイヤーがオークション形式で宝石を取り合い、最終的に獲得した宝石の得点の合計で順位が決定する。

### ゲームの進行

このゲームは$10$フェーズからなり、各フェーズは$3N$ラウンドからなる。

- ゲーム開始時、各プレイヤーは初期資金として赤、緑、青のコインを 10 枚ずつ獲得する。
- 各フェーズでは、以下が行われる。
  - 現時点の宝石に応じて利益が発生し、コインを獲得する。
  - 「オークション」$3N$ ラウンド行う。
- 得点の大きい順で順位付けが行われ、同点の場合は 3 種のコインの総和の大小で順位付けする。それも同じである場合は同順位とする。

### オークション

- 各ラウンドの最初に、今回のオークション対象の宝石が提示される。宝石は「得点」と「フェーズごとに得られる利益」の情報からなる。
- j ラウンド目において、$j\%N$番目のプレイヤーが親となり、順に金額を提示する。
- 金額の提示においては、自分の順までの最高提示金額より大きい金額を提示するか、このオークションを降りるかを選択する。
  例：最高提示額が「赤 4、青 1、緑 2」なら、それぞれ 4,1,2 以上かつどれか一種がそれらを上回るような金額を提示する必要がある。「4,2,3」は正当な提示で、「4,3,1」は正当な提示ではない。
- 最高提示金額の更新がないまま一巡するとオークション終了となり、最高提示金額を提示したプレイヤーが提示した金額と引き換えに宝石を獲得する。

## ゲームの実装

ゲームロジック、AI 実装は Golang を用い、WASM を用いて GitHub Pages にて公開される。

### GameState 構造体、AuctionState 構造体

GameState 構造体は以下の変数からなる。

- Phase int
- Round int
- Scores []int // 各プレイヤーの得点
- Incomes [][3]int // 各プレイヤーのフェーズごとの収益
- moneys [][3]int // 各プレイヤーの現在の資金

AuctionState 構造体は以下の変数からなる。

- maxPlayer int // 最大額を提示しているプレイヤー。まだ誰も入札していない場合は-1
- maxValue [3]int // 暫定最大額。まだ誰も入札していない場合は {0,0,0}
- turn int // 行動選択の番のプレイヤー

Jewel 構造体は以下の変数からなる。

- point int // 入手した際の得点
- income [3]int // 各フェーズに得られる資金

### 入力生成

- 各宝石の得点は 1 以上 10 以下から等確率で選出する
- 宝石から得られる収入は、コインの種類を 0 以上 2 以下から等確率選出したのち、そのコインの収入を 0~5 で定める。他の二種類のコインの収入は 0 である。

### AI interface

AI インターフェースは以下のメソッドで定義する。

GetName() string // AI の名前を返す関数
SelectAction(gameState *GameState, auctionState *AuctionState, jewel \*Jewel) [3]int // 状態を受け取り、提示金額を返す。{0,0,0} で「降りる」を意味する。このほか、提示が不当の場合（最高額を上回っていない、資金が足りていないなど）場合も「降りる」扱いとなる。

### Visualizer の機能

- プレイヤーを 8 人までプルダウンメニューで選択し卓に加えられる。AI のほか、1 人まで人間を追加することが可能。
- ビジュアライザは最上部に現在のフェーズ、ラウンドが表示され、その下には現在のオークション宝石の情報、最高額提示プレイヤー番号、最高額が表示される。
- プレイヤーごとに情報は横長にまとめられており、プレイヤー番号、AI の名前、暫定順位、得点、資金、収入、現在のテーブルでの提示額（or まだ手番が回っていない or 降りている）が一行で表されている。
- 右側にコントロール用パネルを用意し、次へボタンをクリックすることで snapshot を一つ進めることができる。「ラウンド終了へスキップ」ボタンで、このラウンド終了まで進めることができる。「フェーズ終了へスキップ」ボタンで、このフェーズ終了まで進めることができる。各プレイヤーの決断時のほか、落札者決定部分や、ラウンド開始部分、フェーズ開始部分にはプレイヤーの得点等のデータが変動するため snapshot が生成される。
- プレイヤーに人間がいる場合は、金額を提示するための 3 つの数字エリアと「提示」ボタンを用意する。同様に「降りる」ボタンも用意する。プレイヤーの手番以外ではボタンはグレーアウトし、押すことができないようにする。
